window.__require=function t(e,o,i){function n(s,a){if(!o[s]){if(!e[s]){var r=s.split("/");if(r=r[r.length-1],!e[r]){var l="function"==typeof __require&&__require;if(!a&&l)return l(r,!0);if(c)return c(r,!0);throw new Error("Cannot find module '"+s+"'")}s=r}var d=o[s]={exports:{}};e[s][0].call(d.exports,function(t){return n(e[s][1][t]||t)},d,d.exports,t,e,o,i)}return o[s].exports}for(var c="function"==typeof __require&&__require,s=0;s<i.length;s++)n(i[s]);return n}({Demo:[function(t,e,o){"use strict";cc._RF.push(e,"f4b8dPO/MlJRb4BlCGVlcnF","Demo"),Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:i,property:n}=cc._decorator;let c=class extends cc.Component{start(){}};c=__decorate([i],c),o.default=c,cc._RF.pop()},{}],Dialog:[function(t,e,o){"use strict";var i;cc._RF.push(e,"0d8e2mHmYVEwa4w7KH+jrUZ","Dialog"),Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:n,property:c}=cc._decorator;let s=i=class extends cc.Component{constructor(){super(...arguments),this.titleLabel=null,this.contentLabel=null,this.confirmButton=null,this.cancelButton=null}static open(t,e,o,n){i.onConfirm=o||null,i.onCancel=n||null,i.isOpen=!0,i.title=t,i.content=e,i.node&&(i.node.active=!0)}static close(){i.onConfirm=null,i.onCancel=null,i.isOpen=!1,i.title="",i.content="",i.node&&(i.node.active=!1)}start(){i.node=this.node,this.node.on(cc.Node.EventType.TOUCH_START,t=>{t.target!==this.confirmButton.node&&t.target!==this.cancelButton.node&&t.stopPropagation()},this,!0),this.confirmButton.node.on(cc.Node.EventType.TOUCH_START,()=>{i.onConfirm&&i.onConfirm(),i.close()}),this.cancelButton.node.on(cc.Node.EventType.TOUCH_START,()=>{i.onCancel&&i.onCancel(),i.close()})}update(t){this.titleLabel&&this.titleLabel.string!==i.title&&(this.titleLabel.string=i.title),this.contentLabel&&this.contentLabel.string!==i.content&&(this.contentLabel.string=i.content),this.node&&(this.node.active=i.isOpen)}};s.onConfirm=null,s.onCancel=null,s.title="",s.content="",s.isOpen=!1,s.node=null,__decorate([c(cc.Label)],s.prototype,"titleLabel",void 0),__decorate([c(cc.Label)],s.prototype,"contentLabel",void 0),__decorate([c(cc.Button)],s.prototype,"confirmButton",void 0),__decorate([c(cc.Button)],s.prototype,"cancelButton",void 0),s=i=__decorate([n],s),o.default=s,cc._RF.pop()},{}],EntryRoomButtton:[function(t,e,o){"use strict";cc._RF.push(e,"a22b09K4p5Kr6T56oYj3Vn8","EntryRoomButtton"),Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:i,property:n}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.buttonNode=null,this.inputNode=null,this.submitButton=null,this.cancelButton=null,this.editBox=null,this.onSubmit=null,this.onButtonClick=null}showInput(){this.inputNode.active=!0,this.buttonNode.active=!1}closeInput(){this.inputNode.active=!1,this.buttonNode.active=!0}setEnable(t){this.closeInput(),this.buttonNode.children[1].color=t?new cc.Color(255,255,255):new cc.Color(107,110,120),this.buttonNode.children[2].opacity=t?255:76}start(){this.closeInput(),this.cancelButton&&this.cancelButton.node.on(cc.Node.EventType.TOUCH_START,()=>this.closeInput()),this.submitButton&&this.submitButton.node.on(cc.Node.EventType.TOUCH_START,()=>this.onSubmit&&this.onSubmit(this.editBox.string)),this.buttonNode.on(cc.Node.EventType.TOUCH_START,()=>this.onButtonClick&&this.onButtonClick())}};__decorate([n(cc.Node)],c.prototype,"buttonNode",void 0),__decorate([n(cc.Node)],c.prototype,"inputNode",void 0),__decorate([n(cc.Button)],c.prototype,"submitButton",void 0),__decorate([n(cc.Button)],c.prototype,"cancelButton",void 0),__decorate([n(cc.EditBox)],c.prototype,"editBox",void 0),c=__decorate([i],c),o.default=c,cc._RF.pop()},{}],FrameSyncLogic:[function(t,e,o){"use strict";cc._RF.push(e,"fd030cOaOxFvKPueSWMFkDt","FrameSyncLogic"),Object.defineProperty(o,"__esModule",{value:!0}),o.calcFrame=o.setDefauleFrameState=o.reCalcFrameState=o.pushFrames=o.clearFrames=o.frameSyncState=o.FrameSyncCmd=void 0;const i=t("../global");let n=[];var c;function s(t){const e=t.roomInfo||{playerList:[]};o.frameSyncState.players=[],e.playerList.forEach((t,e)=>{const i={x:0,y:e,id:t.id,state:{cmd:c.stop,dir:1,lastUpdateFrameId:1}};a(i,t.id,e),o.frameSyncState.players.push(i)})}function a(t,e,o){t.id=e,t.x=0,t.y=o,t.state.cmd=c.stop,t.state.dir=1,t.state.lastUpdateFrameId=1}(function(t){t[t.run=1]="run",t[t.stop=2]="stop"})(c=o.FrameSyncCmd||(o.FrameSyncCmd={})),o.frameSyncState={players:[]},o.clearFrames=function(){n=[]},o.pushFrames=function(t){n.push(t)},o.reCalcFrameState=function(t){s(t),n.forEach(t=>{p(t)})},o.setDefauleFrameState=s;const r=17,l=0,d=1;function u(t,e){(o.frameSyncState.players.find(e=>e.id===t)||{state:{}}).state.cmd=e}function h(t,e){t.state.cmd!==c.stop&&e-t.state.lastUpdateFrameId>d&&(t.state.lastUpdateFrameId=e,t.x+=1*t.state.dir,(t.x>=r||t.x<=l)&&(t.state.dir*=-1))}function p(t){1===t.id&&s(i.default.room),t.items&&t.items.length>0&&t.items.forEach(t=>{u(t.playerId,t.data.cmd)}),o.frameSyncState.players.forEach(e=>h(e,t.id))}o.calcFrame=p,cc._RF.pop()},{"../global":"global"}],GameState:[function(t,e,o){"use strict";cc._RF.push(e,"ab792dLMhNLtIiZjO6/MJX6","GameState"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],Home:[function(t,e,o){"use strict";var i;cc._RF.push(e,"fc6fehjWWBHqLeJiTPg7S+B","Home"),Object.defineProperty(o,"__esModule",{value:!0});const n=t("../config"),c=t("../util"),{ccclass:s,property:a}=cc._decorator;let r=i=class extends cc.Component{constructor(){super(...arguments),this.gameIdEditBox=null,this.secretKeyEditBox=null,this.urlEditBox=null,this.mgobeNode=null,this.demoButton=null,this.courseButton=null}start(){c.checkMgobe(),i.gameId||(i.gameId=n.default.gameId,i.secretKey=n.default.secretKey,i.url=n.default.url),this.gameIdEditBox.string=i.gameId,this.secretKeyEditBox.string=i.secretKey,this.urlEditBox.string=i.url,this.demoButton.node.on(cc.Node.EventType.TOUCH_START,()=>cc.director.loadScene("demo")),this.courseButton.node.on(cc.Node.EventType.TOUCH_START,()=>c.openLink("https://cloud.tencent.com/document/product/1038/37761")),this.mgobeNode.on(cc.Node.EventType.TOUCH_START,()=>{i.gameId=this.gameIdEditBox.string,i.secretKey=this.secretKeyEditBox.string,i.url=this.urlEditBox.string,c.checkMgobe()&&cc.director.loadScene("mgobe")}),this.gameIdEditBox.node.on(cc.Node.EventType.TOUCH_START,()=>this.showTips()),this.secretKeyEditBox.node.on(cc.Node.EventType.TOUCH_START,()=>this.showTips()),this.urlEditBox.node.on(cc.Node.EventType.TOUCH_START,()=>this.showTips())}showTips(){c.appendLog("\u516c\u6709\u6e38\u620fID\u4e0b\u5206\u914d\u7684\u8d44\u6e90\u6709\u9650\u989d\uff0c\u53ef\u80fd\u4f1a\u5f71\u54cd\u4f53\u9a8c\u6548\u679c\uff1b\u5efa\u8bae\u5728cocos creator\u5185\u5f00\u901aMGOBE\u670d\u52a1\uff0c\u83b7\u53d6\u60a8\u7684\u79c1\u6709\u6e38\u620fID\u3002")}};r.gameId="obg-3mxm9gex",r.secretKey="21b8e6cd50c529b017e5641dad76ca3af485bbd4",r.url="3mxm9gex.wxlagame.com",__decorate([a(cc.EditBox)],r.prototype,"gameIdEditBox",void 0),__decorate([a(cc.EditBox)],r.prototype,"secretKeyEditBox",void 0),__decorate([a(cc.EditBox)],r.prototype,"urlEditBox",void 0),__decorate([a(cc.Node)],r.prototype,"mgobeNode",void 0),__decorate([a(cc.Button)],r.prototype,"demoButton",void 0),__decorate([a(cc.Button)],r.prototype,"courseButton",void 0),r=i=__decorate([s],r),o.default=r,cc._RF.pop()},{"../config":"config","../util":"util"}],LinkLabel:[function(t,e,o){"use strict";cc._RF.push(e,"70290CXHv5KPb3Uwdb1pOkm","LinkLabel"),Object.defineProperty(o,"__esModule",{value:!0});const i=t("../util"),{ccclass:n,property:c}=cc._decorator;let s=class extends cc.Component{constructor(){super(...arguments),this.label=null,this.url=""}start(){this.url&&this.label.node.on(cc.Node.EventType.TOUCH_START,()=>i.openLink(this.url))}};__decorate([c(cc.Label)],s.prototype,"label",void 0),__decorate([c],s.prototype,"url",void 0),s=__decorate([n],s),o.default=s,cc._RF.pop()},{"../util":"util"}],MgobeScene:[function(t,e,o){"use strict";var i;cc._RF.push(e,"300ad9LjVJC86v1A1hsSa7o","MgobeScene"),Object.defineProperty(o,"__esModule",{value:!0});const n=t("../ui/EntryRoomButtton"),c=t("../config"),s=t("../util"),a=t("./Home"),r=t("../global"),{ccclass:l,property:d}=cc._decorator;let u=i=class extends cc.Component{constructor(){super(...arguments),this.initButton=null,this.createRoomNode=null,this.matchNode=null,this.joinRoomNode=null,this.lockSubmit=!1,this.timer=void 0}start(){this.initView(),this.initListener(),this.initSDK()}initView(){s.isInited()?(this.initButton.interactable=!1,this.setEnableButtons(!0)):this.setEnableButtons(!1)}initListener(){this.initButton.node.on(cc.Node.EventType.TOUCH_START,()=>this.initSDK()),this.createRoomNode.onButtonClick=()=>this.onCreateRoomNodeClick(),this.matchNode.onButtonClick=()=>this.onMatchNodeClick(),this.matchNode.onSubmit=t=>!this.lockSubmit&&this.matchPlayers(t),this.joinRoomNode.onButtonClick=()=>this.onJoinRoomNodeClick(),this.joinRoomNode.onSubmit=t=>!this.lockSubmit&&this.joinRoom(t),r.default.room&&(r.default.room.onUpdate=()=>this.onRoomUpdate())}setEnableButtons(t){this.createRoomNode.setEnable(t),this.matchNode.setEnable(t),this.joinRoomNode.setEnable(t)}loadRoomScene(){this.lockSubmit=!0,cc.director.loadScene("room")}onCreateRoomNodeClick(){if(!s.isInited())return s.appendLog("\u8bf7\u5148\u521d\u59cb\u5316 SDK");this.setEnableButtons(!0),!this.lockSubmit&&this.createRoom()}onMatchNodeClick(){if(!s.isInited())return s.appendLog("\u8bf7\u5148\u521d\u59cb\u5316 SDK");this.setEnableButtons(!0),r.default.gameId===c.default.gameId?!this.lockSubmit&&this.matchPlayers(c.default.matchCode):this.matchNode.showInput()}onJoinRoomNodeClick(){if(!s.isInited())return s.appendLog("\u8bf7\u5148\u521d\u59cb\u5316 SDK");this.setEnableButtons(!0),this.joinRoomNode.showInput()}onRoomUpdate(){r.default.room.roomInfo&&r.default.room.roomInfo.playerList&&r.default.room.roomInfo.playerList.find(t=>t.id===MGOBE.Player.id)&&this.loadRoomScene()}onDisable(){r.default.room&&(r.default.room.onUpdate=null),clearInterval(this.timer)}initSDK(){return s.isInited()?s.appendLog("SDK \u5df2\u7ecf\u521d\u59cb\u5316\uff0c\u65e0\u9700\u91cd\u590d\u64cd\u4f5c"):a.default.gameId&&a.default.secretKey&&a.default.url?(s.appendLog("\u6b63\u5728\u521d\u59cb\u5316 SDK"),cc.sys.isNative&&!i.cacertNativeUrl?cc.loader.loadRes("/cacert",cc.Asset,(t,e)=>{s.appendLog("\u52a0\u8f7d\u8bc1\u4e66\u7ed3\u675f "+!t),t||(i.cacertNativeUrl=e.nativeUrl,this.initSDK())}):void s.initSDK(a.default.gameId,a.default.secretKey,a.default.url,i.cacertNativeUrl,t=>{t.code===MGOBE.ErrCode.EC_OK?(s.appendLog("\u521d\u59cb\u5316 SDK \u6210\u529f"),this.initView(),r.default.room.onUpdate=()=>this.onRoomUpdate()):s.appendLog(`\u521d\u59cb\u5316 SDK \u5931\u8d25\uff0c\u9519\u8bef\u7801\uff1a${t.code}`)})):s.appendLog("\u8bf7\u5728\u9996\u9875\u586b\u5165\u6b63\u786e\u7684 gameId\u3001secretKey\u3001url")}createRoom(){this.lockSubmit=!0,s.appendLog("\u6b63\u5728\u521b\u5efa\u623f\u95f4");r.default.room.initRoom(),r.default.room.createRoom({roomName:"cocos_demo",roomType:"create",maxPlayers:5,isPrivate:!0,customProperties:"",playerInfo:{name:"\u6d4b\u8bd5\u73a9\u5bb6",customPlayerStatus:0,customProfile:""}},t=>{this.lockSubmit=!1,t.code===MGOBE.ErrCode.EC_OK?(s.appendLog(`\u521b\u5efa\u623f\u95f4\u6210\u529f\uff0c\u623f\u95f4ID\uff1a${t.data.roomInfo.id}`),this.loadRoomScene()):s.appendLog(`\u521b\u5efa\u623f\u95f4\u5931\u8d25\uff0c\u9519\u8bef\u7801\uff1a${t.code}`)})}matchPlayers(t){if(!t)return s.appendLog("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u5339\u914d Code");this.lockSubmit=!0,this.timer=setInterval(()=>s.appendLog("\u6b63\u5728\u968f\u673a\u5339\u914d\uff0c\u8bf7\u7a0d\u7b49\u3002"),1e3),s.appendLog(`\u6b63\u5728\u968f\u673a\u5339\u914d\uff0c\u5339\u914dCode\uff1a${t}\u3002\u8bf7\u7a0d\u7b49\uff0c\u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\u4e3a 10 \u79d2\u3002`);const e={matchCode:t,playerInfo:{name:"\u6d4b\u8bd5\u73a9\u5bb6",customPlayerStatus:0,customProfile:"",matchAttributes:[]}};r.default.room.initRoom(),r.default.room.matchPlayers(e,t=>{this.lockSubmit=!1,clearInterval(this.timer),t.code===MGOBE.ErrCode.EC_OK?(s.appendLog(`\u968f\u673a\u5339\u914d\u6210\u529f\uff0c\u623f\u95f4ID\uff1a${t.data.roomInfo.id}`),this.loadRoomScene()):s.appendLog(`\u968f\u673a\u5339\u914d\u5931\u8d25\uff0c\u9519\u8bef\u7801\uff1a${t.code}`)})}joinRoom(t){if(!t)return s.appendLog("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u623f\u95f4ID");this.lockSubmit=!0,s.appendLog(`\u6b63\u5728\u52a0\u5165\u623f\u95f4\uff0c\u623f\u95f4ID\uff1a${t}`);r.default.room.initRoom({id:t}),r.default.room.joinRoom({playerInfo:{name:"\u6d4b\u8bd5\u73a9\u5bb6",customPlayerStatus:0,customProfile:""}},t=>{this.lockSubmit=!1,t.code===MGOBE.ErrCode.EC_OK?(s.appendLog(`\u52a0\u5165\u623f\u95f4\u6210\u529f\uff0c\u623f\u95f4ID\uff1a${t.data.roomInfo.id}`),this.loadRoomScene()):s.appendLog(`\u52a0\u5165\u623f\u95f4\u5931\u8d25\uff0c${t.code===MGOBE.ErrCode.EC_ROOM_TEAM_MEMBER_LIMIT_EXCEED?"\u5f53\u524d\u623f\u95f4\u73a9\u5bb6\u6570\u91cf\u5df2\u6ee1\uff0c":""}\u9519\u8bef\u7801\uff1a${t.code}`)})}};u.cacertNativeUrl="",__decorate([d(cc.Button)],u.prototype,"initButton",void 0),__decorate([d(n.default)],u.prototype,"createRoomNode",void 0),__decorate([d(n.default)],u.prototype,"matchNode",void 0),__decorate([d(n.default)],u.prototype,"joinRoomNode",void 0),u=i=__decorate([l],u),o.default=u,cc._RF.pop()},{"../config":"config","../global":"global","../ui/EntryRoomButtton":"EntryRoomButtton","../util":"util","./Home":"Home"}],ReadOnlyEditor:[function(t,e,o){"use strict";cc._RF.push(e,"23865u8EVBMSLkz1GtoQoCL","ReadOnlyEditor"),Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:i,property:n}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.value="",this.editor=null}setValue(t){this.value=t}start(){this.editor=this.node.getComponent(cc.EditBox)}update(t){this.editor.string=this.value}};c=__decorate([i],c),o.default=c,cc._RF.pop()},{}],Room:[function(t,e,o){"use strict";cc._RF.push(e,"a5ba2lery9FjbGmYzzcIjf/","Room"),Object.defineProperty(o,"__esModule",{value:!0}),o.StateSyncCmd=o.SyncType=void 0;const i=t("../global"),n=t("../util"),c=t("../ui/Dialog"),s=t("../ui/TabButton"),a=t("../ui/UIChat"),r=t("../ui/UIStateSync"),l=t("../ui/UIFrameSync"),d=t("../logic/FrameSyncLogic"),u=t("../logic/StateSyncLogic"),h=t("../ui/ReadOnlyEditor"),{ccclass:p,property:m}=cc._decorator;var y,f;(function(t){t.msg="\u623f\u95f4\u5185\u53d1\u6d88\u606f",t.state="\u5b9e\u65f6\u670d\u52a1\u5668\u72b6\u6001\u540c\u6b65",t.frame="\u5e27\u540c\u6b65"})(y=o.SyncType||(o.SyncType={})),function(t){t[t.up=1]="up",t[t.down=2]="down",t[t.left=3]="left",t[t.right=4]="right"}(f=o.StateSyncCmd||(o.StateSyncCmd={}));let g=class extends cc.Component{constructor(){super(...arguments),this.gameIdLlabel=null,this.playerIdLlabel=null,this.roomIdEditBox=null,this.onlineLlabel=null,this.leaveRoomButton=null,this.dismissRoomButton=null,this.dialogPrefab=null,this.roomMsgTabButton=null,this.stateSyncTabButton=null,this.frameSyncTabButton=null,this.syncTypesLabel=null,this.syncTypesTitleLabel=null,this.chatPrefab=null,this.statSyncPrefab=null,this.frameSyncPrefab=null,this.contentNode=null,this.rNodes=[],this.bNodes=[],this.touBtn=null,this.touText=null,this.movable=null,this.player=0,this.moveStep=0,this.waitMovePiece=null,this.end=null,this.endSuccess=null,this.endBtn=null,this.boardNode=null,this.restartAsk=null,this.winText=null,this.selfAsk=null,this.sortEditBox=null,this.sortConfirm=null,this.leftSec=180,this.sec=null,this.inteval=null,this.uiChat=null,this.uiStateSync=null,this.uiFrameSync=null,this.secTask=function(){this.leftSec=this.leftSec-1,this.sec.getComponent(cc.Label).string="\u5012\u8ba1\u65f6\uff1a"+this.leftSec}}initQi(){this.boardNode=cc.find("Canvas/chessBoard"),this.boardNode.on(cc.Node.EventType.TOUCH_START,t=>this.boardClick(t)),this.boardNode.children.filter(t=>{t.x=0,t.y=0,t.on(cc.Node.EventType.TOUCH_START,t=>this.pieceClick(t)),t.active=!0,t.name.startsWith("piece1")&&this.bNodes.push(t),t.name.startsWith("piece2")&&this.rNodes.push(t)}),this.touText=cc.find("Canvas/content/tou"),this.touBtn=cc.find("Canvas/content/button"),this.end=cc.find("Canvas/end"),this.endSuccess=cc.find("Canvas/end/success"),this.endBtn=cc.find("Canvas/end/button"),this.sortEditBox=cc.find("Canvas/content/editbox"),this.sortConfirm=cc.find("Canvas/content/editConfirm"),this.sec=cc.find("Canvas/content/sec"),this.touText.active=!1,this.touBtn.active=!1,this.end.active=!1,this.sortConfirm.active=!1,this.sortEditBox.active=!1,this.sec.active=!1,this.touBtn.on(cc.Node.EventType.TOUCH_START,t=>this.touBtnClick(t)),this.endBtn.on(cc.Node.EventType.TOUCH_START,()=>this.sendEndBtnEvent()),this.sortConfirm.on(cc.Node.EventType.TOUCH_START,()=>this.sortConfirmClick())}sortConfirmClick(){let t=[cc.v2(-160,0),cc.v2(-80,80),cc.v2(-160,80),cc.v2(0,160),cc.v2(-80,160),cc.v2(-160,160)],e=[cc.v2(160,0),cc.v2(80,-80),cc.v2(160,-80),cc.v2(0,-160),cc.v2(80,-160),cc.v2(160,-160)],o=this.sortEditBox.getComponent(cc.EditBox).string;if(6==o.length&&-1!=o.indexOf(1)&&-1!=o.indexOf(2)&&-1!=o.indexOf(3)&&-1!=o.indexOf(4)&&-1!=o.indexOf(5)&&-1!=o.indexOf(6)){if(1==this.player){let t=[];for(let e=0;e<o.length;e++){let i=this.bNodes.filter(t=>t.name.charAt(t.name.length-1)==o[e]);t.push(i[0])}this.bNodes=t,this.bNodes.map((t,o)=>{t.setPosition(e[o].x,e[o].y)})}else{let e=[];for(let t=0;t<o.length;t++){let i=this.rNodes.filter(e=>e.name.charAt(e.name.length-1)==o[t]);e.push(i[0])}this.rNodes=e,this.rNodes.map((e,o)=>{e.setPosition(t[o].x,t[o].y)})}this.sendToClient(JSON.stringify({type:"sort",qiSort:o}))}}sendEndBtnEvent(){this.selfAsk=!0,this.sendToClient(JSON.stringify({type:"restart"})),this.restartAsk&&this.endBtnClick()}endBtnClick(){this.end.active=!1,this.rNodes=[],this.bNodes=[],this.touBtn=null,this.touText=null,this.movable=null,this.moveStep=null,this.waitMovePiece=null,this.restartAsk=null,this.boardNode=null,this.leftSec=180,this.initQi(),this.sortConfirm.active=!0,this.sortEditBox.active=!0}touBtnClick(){cc.log("\u63b7\u9ab0\u5b50");let t=Math.floor(6*Math.random()+1);this.sendToClient(JSON.stringify({type:"tou",num:t})),this.touBtn.active=!1,this.touText.getComponent(cc.Label).string="\u60a8\u63b7\u51fa\uff1a"+t,this.touText.active=!0,this.movable=!0,this.moveStep=t}pieceClick(t){if(cc.log("\u68cb\u5b50\u70b9\u51fb",t),t.stopPropagation(),this.movable&&(this.waitMovePiece&&cc.tween(this.waitMovePiece).to(.2,{scale:1}).start(),t.target&&t.target.name))if(1==this.player&&t.target.name.startsWith("piece1")||2==this.player&&t.target.name.startsWith("piece2")){if(this.findCloseNum(this.player,t.target.name)&&(this.waitMovePiece=t.target,cc.tween(this.waitMovePiece).to(.2,{scale:1.2}).start(),cc.log("\u5c06\u8981\u79fb\u52a8\uff1a"+t.target)),this.waitMovePiece){let e=this.canMove(this.waitMovePiece.x,this.waitMovePiece.y,t.target.x,t.target.y);e&&(this.movePiece(e),this.removePiece(t.target.name))}}else if(this.waitMovePiece){let e=this.canMove(this.waitMovePiece.x,this.waitMovePiece.y,t.target.x,t.target.y);e&&(this.movePiece(e),this.removePiece(t.target.name))}}isWin(t){let e=this.bNodes.filter(t=>t.active),o=this.rNodes.filter(t=>t.active);if(1==t){if(0==o.length)return!0;for(let t=0;t<e.length;t++)if(-160==e[t].x&&160==e[t].y)return!0}else if(2==t){if(0==e.length)return!0;for(let t=0;t<o.length;t++)if(160==o[t].x&&-160==o[t].y)return!0}return!1}boardClick(t){if(this.waitMovePiece){cc.log(t),cc.log(t.getLocation()),cc.log(t.target.convertToNodeSpaceAR(t.getLocation()));let e=t.target.convertToNodeSpaceAR(t.getLocation()),o=this.waitMovePiece.x,i=this.waitMovePiece.y,n=e.x,c=e.y,s=this.canMove(o,i,n,c);s&&this.movePiece(s)}}canMove(t,e,o,i){if(1==this.player){if(this.waitMovePiece.name.startsWith("piece1")){if(cc.log(t,e,o,i),40<t-o&&t-o<120&&Math.abs(e-i)<40)return cc.v2(-80,0);if(40<i-e&&i-e<120&&Math.abs(t-o)<40)return cc.v2(0,80);if(40<t-o&&t-o<120&&40<i-e&&i-e<120)return cc.v2(-80,80)}}else if(2==this.player&&this.waitMovePiece.name.startsWith("piece2")){if(cc.log(t,e,o,i),40<o-t&&o-t<120&&Math.abs(e-i)<40)return cc.v2(80,0);if(40<e-i&&e-i<120&&Math.abs(t-o)<40)return cc.v2(0,-80);if(40<o-t&&o-t<120&&40<e-i&&e-i<120)return cc.v2(80,-80)}}movePiece(t){cc.tween(this.waitMovePiece).by(.2,{position:t,scale:-.2}).start(),this.sendToClient(JSON.stringify({type:"move",piece:this.waitMovePiece.name,x:t.x,y:t.y})),this.movable=!1,this.waitMovePiece=null,setTimeout(()=>{if(this.isWin(this.player)){let t=1==this.player?"\u84dd\u65b9\u83b7\u80dc\uff01":"\u7ea2\u65b9\u83b7\u80dc";this.sendToClient(JSON.stringify({type:"success",winText:t}))}else null!=this.inteval&&(clearInterval(this.inteval),this.inteval=null)},500)}removePiece(t){cc.find("/Canvas/chessBoard/"+t).active=!1,this.sendToClient(JSON.stringify({type:"remove",piece:t}))}findCloseNum(t,e){let o=[];1==t?o=this.bNodes:2==t&&(o=this.rNodes);let i=o.filter(t=>1==t.active),n=6,c=parseInt(e.charAt(e.length-1));for(let s=0;s<i.length;s++){let t=i[s].name.substr(i[s].name.length-1,1),e=parseInt(t),o=Math.abs(e-this.moveStep);o<=n&&(n=o)}return Math.abs(c-this.moveStep)==n}start(){this.initView(),this.initListener(),this.initQi()}initView(){this.initDialog(),this.initPrefab(),this.onRoomUpdate()}randomNum(){let t=i.default.room.roomInfo.id.toLowerCase(),e=t.indexOf("c");if(-1==e&&(e=t.indexOf("o")),-1==e&&(e=t.indexOf("s")),-1==e&&(e=t.indexOf("e")),-1==e&&(e=t.indexOf("a")),-1==e&&(e=t.indexOf("t")),-1==e&&(e=t.indexOf("r")),-1==e&&(e=t.indexOf("p")),-1==e&&(e=t.indexOf("n")),-1==e&&(e=t.indexOf("z")),-1==e&&(e=t.indexOf("h")),-1==e&&(e=t.indexOf("y")),-1==e&&(e=t.indexOf("q")),e>=0&&e<=5){let t=this.rNodes[e];this.rNodes[e]=this.rNodes[0],this.rNodes[0]=t;let o=this.bNodes[e];this.bNodes[e]=this.bNodes[0],this.bNodes[0]=o}}initDialog(){cc.instantiate(this.dialogPrefab).parent=this.node}initListener(){i.default.room&&(i.default.room.onUpdate=()=>this.onRoomUpdate()),this.leaveRoomButton.node.on(cc.Node.EventType.TOUCH_START,()=>this.onLeaveRoomButtonClick()),this.dismissRoomButton.node.on(cc.Node.EventType.TOUCH_START,()=>this.onDismissRoomButtonClick()),this.roomMsgTabButton.node.on(cc.Node.EventType.TOUCH_START,()=>this.onRoomMsgTabButtonClick()),this.stateSyncTabButton.node.on(cc.Node.EventType.TOUCH_START,()=>this.onStateSyncTabButtonClick()),this.frameSyncTabButton.node.on(cc.Node.EventType.TOUCH_START,()=>this.onFrameSyncTabButtonClick()),n.setBroadcastCallbacks(i.default.room,this,this)}initPrefab(){const t=cc.instantiate(this.chatPrefab);t.parent=this.contentNode,this.uiChat=t.getComponent(a.default),this.uiChat.onSubmit=t=>t&&this.sendToClient(t);const e=cc.instantiate(this.statSyncPrefab);e.parent=this.contentNode,this.uiStateSync=e.getComponent(r.default),this.uiStateSync.onUp=()=>this.sendToGameSvr(f.up),this.uiStateSync.onDown=()=>this.sendToGameSvr(f.down),this.uiStateSync.onLeft=()=>this.sendToGameSvr(f.left),this.uiStateSync.onRight=()=>this.sendToGameSvr(f.right);const o=cc.instantiate(this.frameSyncPrefab);o.parent=this.contentNode,this.uiFrameSync=o.getComponent(l.default),this.uiFrameSync.onRunButtonClick=()=>this.sendFrame(d.FrameSyncCmd.run),this.uiFrameSync.onStopButtonClick=()=>this.sendFrame(d.FrameSyncCmd.stop),this.uiFrameSync.onStartFrameButtonClick=()=>this.startFrameSync(),this.uiFrameSync.onStopFrameButtonClick=()=>this.stopFrameSync()}setRoomView(){const t=i.default.room&&i.default.room.roomInfo||{playerList:[],owner:void 0};this.gameIdLlabel.string=i.default.gameId,this.playerIdLlabel.string=MGOBE.Player.id,this.roomIdEditBox.setValue(t.id||""),this.onlineLlabel.string=t.playerList.filter(t=>t.commonNetworkState&&t.relayNetworkState).length+""||"0",this.syncTypesLabel.string=t.customProperties||y.msg,t.owner===MGOBE.Player.id?(this.roomMsgTabButton.node.active=this.stateSyncTabButton.node.active=this.frameSyncTabButton.node.active=!0,this.syncTypesLabel.node.active=this.syncTypesTitleLabel.node.active=!1,this.leaveRoomButton.node.x=this.dismissRoomButton.node.x-20-this.dismissRoomButton.node.width,this.dismissRoomButton.node.active=!0):(this.roomMsgTabButton.node.active=this.stateSyncTabButton.node.active=this.frameSyncTabButton.node.active=!1,this.syncTypesLabel.node.active=this.syncTypesTitleLabel.node.active=!0,this.leaveRoomButton.node.x=this.dismissRoomButton.node.x,this.dismissRoomButton.node.active=!1),this.roomMsgTabButton.setActive(this.syncTypesLabel.string===y.msg),this.stateSyncTabButton.setActive(this.syncTypesLabel.string===y.state),this.frameSyncTabButton.setActive(this.syncTypesLabel.string===y.frame),this.uiChat.node.active=this.roomMsgTabButton.isActive,this.uiStateSync.node.active=this.stateSyncTabButton.isActive,this.uiFrameSync.node.active=this.frameSyncTabButton.isActive,this.uiFrameSync.setButtonState(t.frameSyncState===MGOBE.types.FrameSyncState.START),t.customProperties!==y.frame&&d.setDefauleFrameState({roomInfo:t}),t.customProperties!==y.state&&u.setDefauleSyncState({roomInfo:t}),t.playerList.length!==d.frameSyncState.players.length&&d.reCalcFrameState({roomInfo:t})}onLeaveRoomButtonClick(){c.default.open("\u786e\u5b9a\u8981\u9000\u51fa\u623f\u95f4\u7801\uff1f","\u9000\u51fa\u623f\u95f4\u540e\uff0c\u518d\u8fdb\u5165\u9700\u8981\u91cd\u65b0\u521b\u5efa\u623f\u95f4",()=>this.leaveRoom())}onDismissRoomButtonClick(){c.default.open("\u786e\u5b9a\u8981\u89e3\u6563\u623f\u95f4\u7801\uff1f","\u89e3\u6563\u623f\u95f4\u540e\uff0c\u518d\u8fdb\u5165\u9700\u8981\u91cd\u65b0\u521b\u5efa\u623f\u95f4",()=>this.dismissRoom())}onRoomMsgTabButtonClick(){this.changeCustomProperties(y.msg)}onStateSyncTabButtonClick(){i.default.room&&i.default.room.roomInfo&&i.default.room.roomInfo.frameSyncState===MGOBE.types.FrameSyncState.START?this.stopFrameSync(()=>this.changeCustomProperties(y.state)):this.changeCustomProperties(y.state)}onFrameSyncTabButtonClick(){this.changeCustomProperties(y.frame)}onDisable(){i.default.room&&(i.default.room.onUpdate=null),c.default.close(),n.setBroadcastCallbacks(i.default.room,this,{}),d.clearFrames()}onRoomUpdate(){if(!(i.default.room&&i.default.room.roomInfo&&i.default.room.roomInfo.playerList&&i.default.room.roomInfo.playerList.find(t=>t.id===MGOBE.Player.id)))return cc.director.loadScene("mgobe");this.setRoomView()}changeCustomProperties(t){n.appendLog(`\u6b63\u5728\u4fee\u6539\u623f\u95f4\u81ea\u5b9a\u4e49\u4fe1\u606f\u4e3a\uff1a${t}`),i.default.room.changeRoom({customProperties:t},t=>{t.code===MGOBE.ErrCode.EC_OK?n.appendLog("\u4fee\u6539\u623f\u95f4\u81ea\u5b9a\u4e49\u4fe1\u606f\u6210\u529f"):n.appendLog(`\u4fee\u6539\u623f\u95f4\u81ea\u5b9a\u4e49\u4fe1\u606f\u5931\u8d25\uff0c\u9519\u8bef\u7801\uff1a${t.code}`)})}leaveRoom(){n.appendLog("\u6b63\u5728\u9000\u51fa\u623f\u95f4"),i.default.room.leaveRoom({},t=>{t.code===MGOBE.ErrCode.EC_OK?n.appendLog("\u9000\u51fa\u623f\u95f4\u6210\u529f"):n.appendLog(`\u9000\u51fa\u623f\u95f4\u5931\u8d25\uff0c\u9519\u8bef\u7801\uff1a${t.code}`)})}dismissRoom(){n.appendLog("\u6b63\u5728\u89e3\u6563\u623f\u95f4"),i.default.room.dismissRoom({},t=>{t.code===MGOBE.ErrCode.EC_OK?n.appendLog("\u89e3\u6563\u623f\u95f4\u6210\u529f"):n.appendLog(`\u89e3\u6563\u623f\u95f4\u5931\u8d25\uff0c\u9519\u8bef\u7801\uff1a${t.code}`)})}sendToClient(t){n.appendLog("\u6b63\u5728\u53d1\u9001\u623f\u95f4\u6d88\u606f");const e={recvPlayerList:[],recvType:MGOBE.types.RecvType.ROOM_ALL,msg:t};i.default.room.sendToClient(e,t=>{t.code===MGOBE.ErrCode.EC_OK?n.appendLog("\u53d1\u9001\u623f\u95f4\u6d88\u606f\u6210\u529f"):n.appendLog(`\u53d1\u9001\u623f\u95f4\u6d88\u606f\u5931\u8d25\uff0c\u9519\u8bef\u7801\uff1a${t.code}`)})}sendToGameSvr(t){n.appendLog("\u6b63\u5728\u53d1\u9001\u623f\u95f4\u6d88\u606f");const e={data:{cmd:t}};i.default.room.sendToGameSvr(e,t=>{t.code===MGOBE.ErrCode.EC_OK?n.appendLog("\u53d1\u9001\u5b9e\u65f6\u670d\u52a1\u5668\u6d88\u606f\u6210\u529f"):n.appendLog(`\u53d1\u9001\u5b9e\u65f6\u670d\u52a1\u5668\u6d88\u606f\u5931\u8d25\uff0c\u9519\u8bef\u7801\uff1a${t.code}`)})}sendFrame(t){n.appendLog("\u6b63\u5728\u53d1\u9001\u5e27\u6d88\u606f");const e={data:{cmd:t}};i.default.room.sendFrame(e,t=>{t.code===MGOBE.ErrCode.EC_OK?n.appendLog("\u53d1\u9001\u5e27\u6d88\u606f\u6210\u529f"):n.appendLog(`\u53d1\u9001\u5e27\u6d88\u606f\u5931\u8d25\uff0c\u9519\u8bef\u7801\uff1a${t.code}`)})}startFrameSync(){n.appendLog("\u6b63\u5728\u5f00\u59cb\u5e27\u540c\u6b65"),i.default.room.startFrameSync({},t=>{t.code===MGOBE.ErrCode.EC_OK?n.appendLog("\u5f00\u59cb\u5e27\u540c\u6b65\u6210\u529f"):n.appendLog(`\u5f00\u59cb\u5e27\u540c\u6b65\u5931\u8d25\uff0c\u9519\u8bef\u7801\uff1a${t.code}`)})}stopFrameSync(t){n.appendLog("\u6b63\u5728\u505c\u6b62\u5e27\u540c\u6b65"),i.default.room.stopFrameSync({},e=>{e.code===MGOBE.ErrCode.EC_OK?(n.appendLog("\u505c\u6b62\u5e27\u540c\u6b65\u6210\u529f"),t&&t()):n.appendLog(`\u505c\u6b62\u5e27\u540c\u6b65\u5931\u8d25\uff0c\u9519\u8bef\u7801\uff1a${e.code}`)})}onJoinRoom(t){cc.log("\u5e7f\u64ad\uff1a\u73a9\u5bb6\u8fdb\u623f",t),setTimeout(()=>{this.sendToClient(JSON.stringify({type:"joinRoom",joinPlayerId:t.data.joinPlayerId}))},1e3),n.appendLog("\u5e7f\u64ad\uff1a\u73a9\u5bb6\u8fdb\u623f")}onLeaveRoom(t){n.appendLog("\u5e7f\u64ad\uff1a\u73a9\u5bb6\u9000\u623f")}onDismissRoom(t){return n.appendLog("\u5e7f\u64ad\uff1a\u623f\u95f4\u89e3\u6563"),cc.director.loadScene("mgobe")}onStartFrame(){d.clearFrames()}onStopFrame(){d.clearFrames()}onRecvFromClient(t){if(cc.log("\u6536\u5230\u6d88\u606f\uff1a",t),t.data.msg){let o=JSON.parse(t.data.msg);if("joinRoom"==o.type&&(cc.find("Canvas/content/player2").getComponent(cc.Label).string="\u73a9\u5bb6\uff1a"+o.joinPlayerId,t.data.sendPlayerId==MGOBE.Player.id?this.player=1:this.player=2,this.sortConfirm.active=!0,this.sortEditBox.active=!0),"tou"==o.type&&t.data.sendPlayerId!=MGOBE.Player.id&&(this.touText.getComponent(cc.Label).string="\u73a9\u5bb6"+t.data.sendPlayerId+"\u63b7\u51fa\u4e86\uff1a"+o.num,this.touText.active=!0),"move"==o.type&&t.data.sendPlayerId!=MGOBE.Player.id){this.touBtn.active=!0;let t=cc.v2(o.x,o.y),i=cc.find("/Canvas/chessBoard/"+o.piece);cc.tween(i).by(.2,{position:t}).start();var e=this;null==e.inteval&&(e.inteval=setInterval(()=>{if(e.leftSec<=0){let t=1==this.player?"\u7ea2\u65b9\u83b7\u80dc\uff01":"\u84dd\u65b9\u83b7\u80dc!";this.sendToClient(JSON.stringify({type:"success",winText:t})),clearInterval(e.inteval),e.inteval=null}else e.leftSec=e.leftSec-1,e.sec.getComponent(cc.Label).string="\u5012\u8ba1\u65f6\uff1a"+e.leftSec},1e3))}if("remove"==o.type&&t.data.sendPlayerId!=MGOBE.Player.id&&(cc.find("/Canvas/chessBoard/"+o.piece).active=!1),"success"==o.type&&(this.endSuccess.getComponent(cc.Label).string=o.winText,this.end.active=!0,this.winText=o.winText),"restart"==o.type&&t.data.sendPlayerId!=MGOBE.Player.id&&(this.restartAsk=!0,this.selfAsk&&this.endBtnClick()),"sort"==o.type){let e=80,i=[cc.v2(-2*e,0),cc.v2(-e,e),cc.v2(-2*e,e),cc.v2(0,2*e),cc.v2(-e,2*e),cc.v2(-2*e,2*e)],n=[cc.v2(2*e,0),cc.v2(e,-e),cc.v2(2*e,-e),cc.v2(0,-2*e),cc.v2(e,-2*e),cc.v2(2*e,-2*e)];if(t.data.sendPlayerId!=MGOBE.Player.id){let t=o.qiSort;if(1==this.player){let e=[];for(let o=0;o<t.length;o++){let i=this.rNodes.filter(e=>e.name.charAt(e.name.length-1)==t[o]);e.push(i[0])}this.rNodes=e,this.rNodes.map((t,e)=>{t.setPosition(i[e].x,i[e].y)})}else{let e=[];for(let o=0;o<t.length;o++){let i=this.bNodes.filter(e=>e.name.charAt(e.name.length-1)==t[o]);e.push(i[0])}this.bNodes=e,this.bNodes.map((t,e)=>{t.setPosition(n[e].x,n[e].y)})}cc.log(this.rNodes[0]),cc.log(this.bNodes[0])}if(!(0==this.rNodes[0].x&&0==this.rNodes[0].y||0==this.bNodes[0].x&&0==this.bNodes[0].y)&&(this.sortConfirm.active=!1,this.sortEditBox.active=!1,this.sec.active=!0,1==this.player)){this.touBtn.active=!0;let t=this;null==t.inteval&&(t.inteval=setInterval(()=>{if(t.leftSec<=0){let e="\u84dd\u65b9\u83b7\u80dc\uff01";this.sendToClient(JSON.stringify({type:"success",winText:e})),clearInterval(t.inteval),t.inteval=null}else t.leftSec=t.leftSec-1,t.sec.getComponent(cc.Label).string="\u5012\u8ba1\u65f6\uff1a"+t.leftSec},1e3))}}}this.uiChat.appendMsg(t.data.msg,t.data.sendPlayerId===MGOBE.Player.id)}onRecvFromGameSvr(t){u.setState(t.data&&t.data.data&&t.data.data.players)}onRecvFrame(t){d.pushFrames(t.data.frame),d.calcFrame(t.data.frame)}};__decorate([m(cc.Label)],g.prototype,"gameIdLlabel",void 0),__decorate([m(cc.Label)],g.prototype,"playerIdLlabel",void 0),__decorate([m(h.default)],g.prototype,"roomIdEditBox",void 0),__decorate([m(cc.Label)],g.prototype,"onlineLlabel",void 0),__decorate([m(cc.Button)],g.prototype,"leaveRoomButton",void 0),__decorate([m(cc.Button)],g.prototype,"dismissRoomButton",void 0),__decorate([m(cc.Prefab)],g.prototype,"dialogPrefab",void 0),__decorate([m(s.default)],g.prototype,"roomMsgTabButton",void 0),__decorate([m(s.default)],g.prototype,"stateSyncTabButton",void 0),__decorate([m(s.default)],g.prototype,"frameSyncTabButton",void 0),__decorate([m(cc.Label)],g.prototype,"syncTypesLabel",void 0),__decorate([m(cc.Label)],g.prototype,"syncTypesTitleLabel",void 0),__decorate([m(cc.Prefab)],g.prototype,"chatPrefab",void 0),__decorate([m(cc.Prefab)],g.prototype,"statSyncPrefab",void 0),__decorate([m(cc.Prefab)],g.prototype,"frameSyncPrefab",void 0),__decorate([m(cc.Node)],g.prototype,"contentNode",void 0),__decorate([m([cc.Node])],g.prototype,"rNodes",void 0),__decorate([m([cc.Node])],g.prototype,"bNodes",void 0),__decorate([m(cc.Node)],g.prototype,"touBtn",void 0),__decorate([m(cc.Node)],g.prototype,"touText",void 0),__decorate([m()],g.prototype,"movable",void 0),__decorate([m()],g.prototype,"player",void 0),__decorate([m()],g.prototype,"moveStep",void 0),__decorate([m(cc.Node)],g.prototype,"waitMovePiece",void 0),__decorate([m(cc.Node)],g.prototype,"end",void 0),__decorate([m(cc.Label)],g.prototype,"endSuccess",void 0),__decorate([m(cc.Node)],g.prototype,"endBtn",void 0),__decorate([m(cc.Node)],g.prototype,"boardNode",void 0),__decorate([m()],g.prototype,"restartAsk",void 0),__decorate([m()],g.prototype,"winText",void 0),__decorate([m()],g.prototype,"selfAsk",void 0),__decorate([m(cc.EditBox)],g.prototype,"sortEditBox",void 0),__decorate([m(cc.Node)],g.prototype,"sortConfirm",void 0),__decorate([m()],g.prototype,"leftSec",void 0),__decorate([m(cc.Node)],g.prototype,"sec",void 0),g=__decorate([p],g),o.default=g,cc._RF.pop()},{"../global":"global","../logic/FrameSyncLogic":"FrameSyncLogic","../logic/StateSyncLogic":"StateSyncLogic","../ui/Dialog":"Dialog","../ui/ReadOnlyEditor":"ReadOnlyEditor","../ui/TabButton":"TabButton","../ui/UIChat":"UIChat","../ui/UIFrameSync":"UIFrameSync","../ui/UIStateSync":"UIStateSync","../util":"util"}],StateSyncLogic:[function(t,e,o){"use strict";function i(t){Array.isArray(t)&&(o.stateSyncState.players=[],t.forEach(t=>{const e={id:t.id,x:t.x,y:t.y};o.stateSyncState.players.push(e)}))}cc._RF.push(e,"dc097KSQHtKr7tHSSJGosLp","StateSyncLogic"),Object.defineProperty(o,"__esModule",{value:!0}),o.setState=o.setDefauleSyncState=o.stateSyncState=void 0,o.stateSyncState={players:[]},o.setDefauleSyncState=function(t){i((t.roomInfo||{playerList:[]}).playerList.map((t,e)=>({x:0,y:e,id:t.id})))},o.setState=i,cc._RF.pop()},{}],TabButton:[function(t,e,o){"use strict";cc._RF.push(e,"b3c98BiNn9HQqgxl74vtegX","TabButton"),Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:i,property:n}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.bg1Node=null,this.bg2Node=null,this.isActive=!1}setActive(t){this.isActive=t}start(){}update(t){this.bg1Node.active=!this.isActive,this.bg2Node.active=!!this.isActive,this.node.getComponent(cc.Button).interactable=!this.isActive}};__decorate([n(cc.Node)],c.prototype,"bg1Node",void 0),__decorate([n(cc.Node)],c.prototype,"bg2Node",void 0),c=__decorate([i],c),o.default=c,cc._RF.pop()},{}],TitleBar:[function(t,e,o){"use strict";cc._RF.push(e,"4bfd93AV8ZPzqKcFFi3jVPS","TitleBar"),Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:i,property:n}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.backBtn=null,this.backScene=""}start(){this.backScene&&this.backBtn.on(cc.Node.EventType.TOUCH_START,()=>cc.director.loadScene(this.backScene))}};__decorate([n(cc.Node)],c.prototype,"backBtn",void 0),__decorate([n],c.prototype,"backScene",void 0),c=__decorate([i],c),o.default=c,cc._RF.pop()},{}],UIChat:[function(t,e,o){"use strict";cc._RF.push(e,"e346cxClG9LNrhvYjT/i1Sy","UIChat"),Object.defineProperty(o,"__esModule",{value:!0});const i=t("./UIMessage"),{ccclass:n,property:c}=cc._decorator;let s=class extends cc.Component{constructor(){super(...arguments),this.msgRightPrefab=null,this.msgLeftPrefab=null,this.scrollContentNode=null,this.scrollView=null,this.sendButton=null,this.msgEditBox=null,this.onSubmit=null}appendMsg(t,e){const o=e?this.msgRightPrefab:this.msgLeftPrefab,n=cc.instantiate(o);n.parent=this.scrollContentNode,n.getComponent(i.default).setMessage(t)}refreshMsgItems(){let t=30;this.scrollContentNode.children.forEach(e=>{e.y=-t,t+=e.height+10}),this.scrollContentNode.height!==t&&(this.scrollContentNode.height=t,this.scrollView.scrollToBottom())}callback(){const t=this.msgEditBox.string||"";this.onSubmit&&this.onSubmit(t),this.msgEditBox.string=""}start(){this.sendButton.node.off(cc.Node.EventType.TOUCH_START,this.callback,this),this.sendButton.node.on(cc.Node.EventType.TOUCH_START,this.callback,this)}update(t){this.refreshMsgItems()}};__decorate([c(cc.Prefab)],s.prototype,"msgRightPrefab",void 0),__decorate([c(cc.Prefab)],s.prototype,"msgLeftPrefab",void 0),__decorate([c(cc.Node)],s.prototype,"scrollContentNode",void 0),__decorate([c(cc.ScrollView)],s.prototype,"scrollView",void 0),__decorate([c(cc.Button)],s.prototype,"sendButton",void 0),__decorate([c(cc.EditBox)],s.prototype,"msgEditBox",void 0),s=__decorate([n],s),o.default=s,cc._RF.pop()},{"./UIMessage":"UIMessage"}],UIFrameSync:[function(t,e,o){"use strict";cc._RF.push(e,"641afWQOMJGZ7xgSV5IDdFq","UIFrameSync"),Object.defineProperty(o,"__esModule",{value:!0});const i=t("./UIMap"),n=t("../global"),c=t("../logic/FrameSyncLogic"),{ccclass:s,property:a}=cc._decorator;let r=class extends cc.Component{constructor(){super(...arguments),this.startFrameButton=null,this.stopFrameButton=null,this.runButton=null,this.stopButton=null,this.map=null,this.frameRateLabel=null,this.onStartFrameButtonClick=null,this.onStopFrameButtonClick=null,this.onRunButtonClick=null,this.onStopButtonClick=null}setFrameRate(t){this.frameRateLabel.string=t+""}setMapSize(t,e){const o="number"!=typeof t?this.map.w:t,i="number"!=typeof e?this.map.h:e;this.map.setMapSize(o,i)}setButtonState(t){this.startFrameButton.interactable=!t,this.stopFrameButton.interactable=t,this.runButton.interactable=t,this.stopButton.interactable=t}start(){this.startFrameButton.node.off(cc.Node.EventType.TOUCH_START,this.onStartFrameButtonClickCallback,this),this.stopFrameButton.node.off(cc.Node.EventType.TOUCH_START,this.onStopFrameButtonClickCallback,this),this.runButton.node.off(cc.Node.EventType.TOUCH_START,this.onRunButtonClick,this),this.stopButton.node.off(cc.Node.EventType.TOUCH_START,this.onStopButtonClickCallback,this),this.startFrameButton.node.on(cc.Node.EventType.TOUCH_START,this.onStartFrameButtonClickCallback,this),this.stopFrameButton.node.on(cc.Node.EventType.TOUCH_START,this.onStopFrameButtonClickCallback,this),this.runButton.node.on(cc.Node.EventType.TOUCH_START,this.onRunButtonClickCallback,this),this.stopButton.node.on(cc.Node.EventType.TOUCH_START,this.onStopButtonClickCallback,this),this.setFrameRate(15),c.reCalcFrameState(n.default.room)}update(t){this.map.setPlayers(c.frameSyncState.players)}onStartFrameButtonClickCallback(){this.startFrameButton.interactable&&this.onStartFrameButtonClick&&this.onStartFrameButtonClick()}onStopFrameButtonClickCallback(){this.stopFrameButton.interactable&&this.onStopFrameButtonClick&&this.onStopFrameButtonClick()}onRunButtonClickCallback(){this.runButton.interactable&&this.onRunButtonClick&&this.onRunButtonClick()}onStopButtonClickCallback(){this.stopButton.interactable&&this.onStopButtonClick&&this.onStopButtonClick()}};__decorate([a(cc.Button)],r.prototype,"startFrameButton",void 0),__decorate([a(cc.Button)],r.prototype,"stopFrameButton",void 0),__decorate([a(cc.Button)],r.prototype,"runButton",void 0),__decorate([a(cc.Button)],r.prototype,"stopButton",void 0),__decorate([a(i.default)],r.prototype,"map",void 0),__decorate([a(cc.Label)],r.prototype,"frameRateLabel",void 0),r=__decorate([s],r),o.default=r,cc._RF.pop()},{"../global":"global","../logic/FrameSyncLogic":"FrameSyncLogic","./UIMap":"UIMap"}],UILog:[function(t,e,o){"use strict";var i;cc._RF.push(e,"c6b77FwWyJLwpcXKfx1nbCo","UILog"),Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:n,property:c}=cc._decorator;let s=i=class extends cc.Component{constructor(){super(...arguments),this.scrollView=null,this.logLabel=null,this.contentNode=null,this.length=0}static appendLog(t){i.staticLogStrs.push(t)}setLogStr(t){this.logLabel.string=t+"\n\n"}start(){}update(t){this.length!==i.staticLogStrs.length&&this.setLogStr(i.staticLogStrs.slice(-10).join("\n")),this.length=i.staticLogStrs.length,this.contentNode.height!==this.logLabel.node.height&&(this.contentNode.height=this.logLabel.node.height,this.scrollView.scrollToBottom())}};s.staticLogStrs=["\u6682\u65e0\u65e5\u5fd7\u4fe1\u606f"],__decorate([c(cc.ScrollView)],s.prototype,"scrollView",void 0),__decorate([c(cc.Label)],s.prototype,"logLabel",void 0),__decorate([c(cc.Node)],s.prototype,"contentNode",void 0),s=i=__decorate([n],s),o.default=s,cc._RF.pop()},{}],UIMap:[function(t,e,o){"use strict";cc._RF.push(e,"7bd5c689FVLhI65kaxzlAle","UIMap"),Object.defineProperty(o,"__esModule",{value:!0});const i=t("./UIPlayer"),{ccclass:n,property:c}=cc._decorator;let s=null;function a(t){if(!s){s=new cc.NodePool;for(let e=0;e<5;e++){let e=cc.instantiate(t);s.put(e)}}}function r(t){s.put(t)}let l=class extends cc.Component{constructor(){super(...arguments),this.playerPrefab=null,this.w=13,this.h=6,this.players=[],this.tileSize=40}setMapSize(t,e){this.w=t,this.h=e}setPlayers(t){Array.isArray(t)||(t=[]),this.players.splice(t.length).forEach(t=>r(t));for(let o=this.players.length;o<t.length;o++)this.players.push((e=this.playerPrefab,s.size()>0?s.get():cc.instantiate(e)));var e;t.forEach((t,e)=>{const o=this.players[e].getComponent(i.default),{x:n,y:c}=this.convertPosition(t.x,t.y);o.node.parent=this.node,o.initPlayer(t.id,n,c)})}convertPosition(t,e){return{x:t*this.tileSize+this.tileSize/2,y:e*this.tileSize+this.tileSize/2}}start(){a(this.playerPrefab)}update(t){this.node.width=this.w*this.tileSize,this.node.height=this.h*this.tileSize}};__decorate([c(cc.Prefab)],l.prototype,"playerPrefab",void 0),l=__decorate([n],l),o.default=l,cc._RF.pop()},{"./UIPlayer":"UIPlayer"}],UIMessage:[function(t,e,o){"use strict";cc._RF.push(e,"c031aWugCRDkZE14NBoZkdU","UIMessage"),Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:i,property:n}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.label=null,this.bgSprite=null,this.msg="",this.padding=10,this.maxLabelWidth=400}setMessage(t){this.msg=t}start(){}update(t){this.label.string!==this.msg&&(this.label.string=this.msg),this.label.node.height<30&&(this.label.overflow=cc.Label.Overflow.NONE),this.label.node.width>this.maxLabelWidth&&(this.label.overflow=cc.Label.Overflow.RESIZE_HEIGHT,this.label.node.width=this.maxLabelWidth),this.bgSprite.node.width=this.label.node.width+this.padding+Math.abs(this.label.node.x-this.bgSprite.node.x),this.node.height=this.label.node.height+2*this.padding,this.bgSprite.node.height=this.node.height}};__decorate([n(cc.Label)],c.prototype,"label",void 0),__decorate([n(cc.Sprite)],c.prototype,"bgSprite",void 0),c=__decorate([i],c),o.default=c,cc._RF.pop()},{}],UIPlayer:[function(t,e,o){"use strict";cc._RF.push(e,"4fed5v2tVpJsoLfwroC693q","UIPlayer"),Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:i,property:n}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.label=null,this.icon1Sprite=null,this.icon2Sprite=null}initPlayer(t,e=0,o=0){t===MGOBE.Player.id?(t="\u6211",this.icon1Sprite.node.active=!0,this.icon2Sprite.node.active=!1):(this.icon1Sprite.node.active=!1,this.icon2Sprite.node.active=!0),this.label.string=t,this.setPosition(e,o)}setPosition(t,e){this.node.x=t,this.node.y=e}start(){}};__decorate([n(cc.Label)],c.prototype,"label",void 0),__decorate([n(cc.Sprite)],c.prototype,"icon1Sprite",void 0),__decorate([n(cc.Sprite)],c.prototype,"icon2Sprite",void 0),c=__decorate([i],c),o.default=c,cc._RF.pop()},{}],UIStateSync:[function(t,e,o){"use strict";cc._RF.push(e,"195a7y/ZdVIiIl+5ujA6bFS","UIStateSync"),Object.defineProperty(o,"__esModule",{value:!0});const i=t("./UIMap"),n=t("../global"),c=t("../logic/StateSyncLogic"),{ccclass:s,property:a}=cc._decorator;let r=class extends cc.Component{constructor(){super(...arguments),this.upButton=null,this.downButton=null,this.leftButton=null,this.rightButton=null,this.map=null,this.tipsLabel=null,this.onUp=null,this.onDown=null,this.onLeft=null,this.onRight=null}setTips(t){this.tipsLabel.string=t}setMapSize(t,e){const o="number"!=typeof t?this.map.w:t,i="number"!=typeof e?this.map.h:e;this.map.setMapSize(o,i)}start(){this.upButton.node.off(cc.Node.EventType.TOUCH_START,this.onUpButtonClick,this),this.downButton.node.off(cc.Node.EventType.TOUCH_START,this.onDownButtonClick,this),this.leftButton.node.off(cc.Node.EventType.TOUCH_START,this.onLeftButtonClick,this),this.rightButton.node.off(cc.Node.EventType.TOUCH_START,this.onRightButtonClick,this),this.upButton.node.on(cc.Node.EventType.TOUCH_START,this.onUpButtonClick,this),this.downButton.node.on(cc.Node.EventType.TOUCH_START,this.onDownButtonClick,this),this.leftButton.node.on(cc.Node.EventType.TOUCH_START,this.onLeftButtonClick,this),this.rightButton.node.on(cc.Node.EventType.TOUCH_START,this.onRightButtonClick,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),this.setTips(""),c.setDefauleSyncState(n.default.room)}update(t){this.setTips("\u66f4\u6539\u81ea\u5b9a\u4e49\u903b\u8f91\u6b65\u9aa4\uff1a\n\uff081\uff09\u5728DEMO\u9996\u9875\u5c06\u6e38\u620fID\u3001Key\u66ff\u6362\u4e3a\u60a8\u7684\u79c1\u6709ID\u3001Key\n\uff082\uff09\u5728\u9879\u76eeserverless\\mgobe-server\\mgobexs\\src\\mgobexs\u4e0b\u4fee\u6539\u548c\u7f16\u8bd1\u60a8\u7684\u670d\u52a1\u7aef\u903b\u8f91\n\uff083\uff09\u5728IDE\u7684\u670d\u52a1\u9762\u677f\u2014MGOBE\u2014\u5b9e\u65f6\u670d\u52a1\u5668\u4e0b\uff0c\u70b9\u51fb\u201c\u7acb\u5373\u53d1\u5e03\u201d\uff0c\u5e76\u6309\u6307\u5f15\u8fdb\u884c\u540e\u7eed\u64cd\u4f5c"),this.map.setPlayers(c.stateSyncState.players)}onUpButtonClick(){this.onUp&&this.onUp()}onDownButtonClick(){this.onDown&&this.onDown()}onLeftButtonClick(){this.onLeft&&this.onLeft()}onRightButtonClick(){this.onRight&&this.onRight()}onKeyDown(t){switch(t&&t.keyCode){case 87:return this.onUpButtonClick();case 83:return this.onDownButtonClick();case 65:return this.onLeftButtonClick();case 68:return this.onRightButtonClick()}}};__decorate([a(cc.Button)],r.prototype,"upButton",void 0),__decorate([a(cc.Button)],r.prototype,"downButton",void 0),__decorate([a(cc.Button)],r.prototype,"leftButton",void 0),__decorate([a(cc.Button)],r.prototype,"rightButton",void 0),__decorate([a(i.default)],r.prototype,"map",void 0),__decorate([a(cc.Label)],r.prototype,"tipsLabel",void 0),r=__decorate([s],r),o.default=r,cc._RF.pop()},{"../global":"global","../logic/StateSyncLogic":"StateSyncLogic","./UIMap":"UIMap"}],config:[function(t,e,o){"use strict";cc._RF.push(e,"a8db8oM0pVCBqMY+EmxpbqN","config"),Object.defineProperty(o,"__esModule",{value:!0}),o.default={gameId:"obg-3mxm9gex",secretKey:"21b8e6cd50c529b017e5641dad76ca3af485bbd4",url:"3mxm9gex.wxlagame.com",openId:(()=>{let t=Date.now().toString(36);for(let e=0;e<7;e++)t+=Math.ceil(Math.random()*Math.pow(10,4)).toString(36);return t})(),matchCode:"match-ofvr1fjj"},cc._RF.pop()},{}],global:[function(t,e,o){"use strict";cc._RF.push(e,"39d54I9xJVAHLuoGeKSDGG4","global"),Object.defineProperty(o,"__esModule",{value:!0}),o.default=new class{constructor(){this.gameId="",this.room=null}},cc._RF.pop()},{}],"use_v2.1-2.2.1_cc.Toggle_event":[function(t,e){"use strict";cc._RF.push(e,"af2019VejdOX54d5RgQXrZy","use_v2.1-2.2.1_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_isChecked=!0),cc._RF.pop()},{}],util:[function(t,e,o){"use strict";cc._RF.push(e,"8063arAqUBI272BtqJ3F3Pe","util"),Object.defineProperty(o,"__esModule",{value:!0}),o.checkMgobe=o.openLink=o.appendLog=o.setBroadcastCallbacks=o.isInited=o.initSDK=void 0;const i=t("./config"),n=t("./global"),c=t("./ui/UILog"),s=t("./logic/FrameSyncLogic");function a(){return!!MGOBE.Player&&!!MGOBE.Player.id}function r(t,e,o){if(!t)return;const i={onJoinRoom:()=>()=>null,onLeaveRoom:()=>()=>null,onChangeRoom:()=>()=>null,onDismissRoom:()=>()=>null,onStartFrameSync:()=>()=>null,onStopFrameSync:()=>()=>null,onRecvFrame:t=>{s.calcFrame(t.data.frame)},onChangeCustomPlayerStatus:()=>()=>null,onRemovePlayer:()=>()=>null,onRecvFromClient:()=>()=>null,onRecvFromGameSvr:()=>()=>null,onAutoRequestFrameError:()=>()=>null};Object.keys(i).forEach(n=>{const c=o[n]?o[n].bind(e):i[n];t[n]=c})}function l(t){return c.default.appendLog(t)}o.initSDK=function(t,e,o,c,s){if(a())return s&&s({code:MGOBE.ErrCode.EC_OK});const l={gameId:i.default.gameId,openId:i.default.openId,secretKey:i.default.secretKey},d={url:i.default.url,isAutoRequestFrame:!0,cacertNativeUrl:""};Object.assign(l,{gameId:t,secretKey:e}),Object.assign(d,{url:o,cacertNativeUrl:c}),MGOBE.DebuggerLog.enable=!0,cc.sys.isNative&&(MGOBE.DebuggerLog.enable=!1),MGOBE.Listener.init(l,d,t=>{t.code===MGOBE.ErrCode.EC_OK&&(n.default.room=new MGOBE.Room,n.default.gameId=l.gameId,MGOBE.Listener.add(n.default.room),r(n.default.room,null,{})),s&&s({code:t.code})})},o.isInited=a,o.setBroadcastCallbacks=r,o.appendLog=l,o.openLink=function(t,e){return"undefined"==typeof window?l("\u65e0\u6cd5\u6253\u5f00\u94fe\u63a5"):"function"!=typeof window.open?l("\u65e0\u6cd5\u6253\u5f00\u94fe\u63a5"):void window.open(t,e&&"_blank")},o.checkMgobe=function(){if("undefined"!=typeof MGOBE)return!0;const t="\u8bf7\u5148\u542f\u7528\u817e\u8baf\u4e91 MGOBE \u670d\u52a1\u5bfc\u5165 MGOBE SDK\uff01";return console.log(t),l(t),!1},cc._RF.pop()},{"./config":"config","./global":"global","./logic/FrameSyncLogic":"FrameSyncLogic","./ui/UILog":"UILog"}]},{},["config","global","FrameSyncLogic","GameState","StateSyncLogic","Demo","Home","MgobeScene","Room","Dialog","EntryRoomButtton","LinkLabel","ReadOnlyEditor","TabButton","TitleBar","UIChat","UIFrameSync","UILog","UIMap","UIMessage","UIPlayer","UIStateSync","util","use_v2.1-2.2.1_cc.Toggle_event"]);